---
alwaysApply: true
---

## Spec Folder Documentation Rules

**Purpose:** Comprehensive guide for maintaining spec/ folder with active documentation and organized archive.

---

## Code Organization Rule

- **Always** put analysis md's to the spec folder.

---

## Spec Folder Structure (November 3, 2025)

The `spec/` folder contains **13 active documents** (current work) and `archive/` for historical reference.

**Active Documents (spec/ root):**

```
spec/
‚îú‚îÄ‚îÄ README.md                              ‚≠ê Main navigation hub
‚îú‚îÄ‚îÄ AUDIT_STATUS.md                        ‚≠ê Current audit dashboard
‚îÇ
‚îú‚îÄ‚îÄ AUDIT.md                               üîê Security master log
‚îú‚îÄ‚îÄ HISTORICAL_FIXES.md                    üîê Past vulnerabilities
‚îÇ
‚îú‚îÄ‚îÄ GOV.md                                 üìñ Governance reference
‚îú‚îÄ‚îÄ FEE_SPLITTER.md                        üìñ Fee distribution
‚îú‚îÄ‚îÄ USER_FLOWS.md                          üìñ User interactions
‚îú‚îÄ‚îÄ TESTING.md                             üìñ Test guide
‚îú‚îÄ‚îÄ MULTISIG.md                            üîë Gnosis Safe multisig info
‚îÇ
‚îú‚îÄ‚îÄ CHANGELOG.md                           üìÖ Feature evolution
‚îú‚îÄ‚îÄ FUTURE_ENHANCEMENTS.md                 üìÖ Roadmap
‚îÇ
‚îî‚îÄ‚îÄ consolidations/ (in archive/)
    ‚îú‚îÄ‚îÄ CONSOLIDATION_PHASE_3_NOV_03_2025.md
    ‚îî‚îÄ‚îÄ CONSOLIDATION_NOV_03_2025.md
```

**Archive Directory:**

- `spec/archive/` - Organized historical documentation (116+ files)
  - `archive/consolidations/` - Consolidation records
  - `archive/audits/` - Completed audit work + detailed reports
  - `archive/findings/` - Analysis, findings, implementation research
  - `archive/testing/` - Historical test analysis
  - `archive/obsolete-designs/` - Old design exploration

---

## Where to Find Current Data (Always Start Here)

### üö® AUDIT STATUS

- **Dashboard:** `spec/AUDIT_STATUS.md` - Current audit status, timeline to mainnet
- **Security Log:** `spec/AUDIT.md` - Complete security findings and fixes
- **Past Fixes:** `spec/HISTORICAL_FIXES.md` - Past bugs and lessons learned

### üìñ PROTOCOL REFERENCE

- **Governance:** `spec/GOV.md` - Mechanics, glossary, quick lookup
- **Fee Distribution:** `spec/FEE_SPLITTER.md` - Architecture, integration
- **User Flows:** `spec/USER_FLOWS.md` - Interaction patterns, edge cases
- **Testing:** `spec/TESTING.md` - Test strategies, commands, utilities
- **Multisig:** `spec/MULTISIG.md` - Gnosis Safe multisig configuration

### üìÖ PLANNING

- **Evolution:** `spec/CHANGELOG.md` - Feature timeline
- **Future:** `spec/FUTURE_ENHANCEMENTS.md` - Roadmap and V2 ideas

---

## Where to Find Historical Data

**Archive Location:** `spec/archive/`

**Completed Audits:**

- `archive/audits/EXTERNAL_AUDIT_0.md` - First audit (8/8 fixed)
- `archive/audits/EXTERNAL_AUDIT_2_COMPLETE.md` - AUDIT 2 summary (13/13 fixed)
- `archive/audits/audit-2-details/` - 8 technical analysis reports
- `archive/audits/audit-3-details/` - 15 technical analysis reports
- `archive/audits/audit-4/` - AUDIT 4 working documents

**Past Consolidations:**

- `archive/consolidations/` - All past consolidation records
- Sorted by recency with naming: `CONSOLIDATION_YYYY_MM_DD_PHASE_N.md`

**Specific Findings:**

- `archive/findings/COMPARATIVE_AUDIT.md` - Industry benchmarks
- `archive/findings/ADERYN_ANALYSIS.md` - Static analysis
- `archive/findings/implementation-analysis/` - Technical deep-dives
- `archive/findings/oct-2025/` - October 2025 development analysis

**Historical Testing:**

- `archive/testing/COVERAGE_ANALYSIS.md` - Historical coverage metrics
- Current coverage in `spec/TESTING.md`

**Obsolete Designs:**

- `archive/obsolete-designs/` - 10 design exploration documents
- Transferable token designs, upgradeability exploration, pool-based design

---

## When Adding New Documentation

### Security Findings

- **All findings** ‚Üí Always log in `spec/AUDIT.md` (master security log)
- **Fixed bugs** ‚Üí Add to `spec/HISTORICAL_FIXES.md` with lessons learned
- **Completed audit** ‚Üí Move actions to `archive/audits/`

### Protocol Changes

- **Governance mechanics** ‚Üí Update `spec/GOV.md`
- **Fee distribution** ‚Üí Update `spec/FEE_SPLITTER.md`
- **User interactions** ‚Üí Update `spec/USER_FLOWS.md`
- **Version tracking** ‚Üí Update `spec/CHANGELOG.md`

### Analysis & Research

- **Test strategies** ‚Üí Update `spec/TESTING.md`
- **Future features** ‚Üí Update `spec/FUTURE_ENHANCEMENTS.md`
- **One-off analysis** ‚Üí Create in `spec/`, plan to archive when complete

---

## Documentation Consolidation Guidelines

### WHEN TO CONSOLIDATE (Red Flags)

1. **File count > 20 in spec/ root** ‚Üí Time to consolidate
2. **Multiple docs on same topic** ‚Üí Merge into single source of truth
3. **"Which doc is current?"** ‚Üí Clear sign of duplication
4. **Temp analysis files aging** ‚Üí Archive or integrate into main docs

### HOW TO CONSOLIDATE

1. **Identify active work:**
   - Protocol references (GOV, FEE_SPLITTER, USER_FLOWS, TESTING)
   - Security logs (AUDIT, HISTORICAL_FIXES)
   - Planning docs (CHANGELOG, FUTURE_ENHANCEMENTS)

2. **Merge overlapping docs:**
   - Audit + Validation + Summary ‚Üí Single ACTIONS.md
   - Multiple findings on same topic ‚Üí Into AUDIT.md or HISTORICAL_FIXES.md
   - Temporary analysis ‚Üí Into appropriate main doc

3. **Archive completed work:**
   - Completed audits ‚Üí `archive/audits/`
   - Past consolidations ‚Üí `archive/consolidations/`
   - Specific findings (now in AUDIT.md) ‚Üí `archive/findings/`
   - Old test analysis ‚Üí `archive/testing/`
   - Obsolete designs ‚Üí `archive/obsolete-designs/`

4. **Create clear navigation:**
   - Update `spec/README.md` with current structure
   - Update `archive/README.md` for historical navigation

5. **Verify:**
   - No duplicate information
   - All links work
   - Clear "start here" pointers
   - Archive remains accessible

### TARGET STATE

- **Active files in spec/:** ~12-15 files (max 20)
- **Single source of truth** per topic
- **Clear entry points** (README, AUDIT_STATUS)
- **Archive organized** with subdirectories

---

## Current Spec Status (November 3, 2025)

**Active Files:** 13 (consolidated, maintainable)  
**Archive Files:** 116+ (organized by type and phase)  
**Last Consolidation:** November 3, 2025  
**Archive Structure:** 5 subdirectories + README navigation

---

## Documentation Best Practices

### ‚úÖ DO

- **Start with README.md** - Check navigation first
- **Use AUDIT_STATUS.md** - For current audit status
- **Update AUDIT.md** - For all security findings
- **Archive completed work** - Move to archive/ when done
- **One file per topic** - Merge duplicates
- **Clear naming** - Use descriptive, unique names
- **Add README to every archive subdirectory** - Maintain navigation
- **Sync spec/ files after archive changes** - CRITICAL requirement

### ‚ùå DON'T

- **Create duplicate docs** - Merge into existing
- **Keep temp analysis files** - Integrate or archive within 1 week
- **Reference deleted files** - Update links when consolidating
- **Let spec/ grow past 20 files** - Consolidate when hitting limit
- **Archive without syncing spec/** - Must update spec/ references
- **Skip README files in archive** - Every subdirectory needs one

---

## Quick Lookups

### Current Status

- Audit status ‚Üí `spec/AUDIT_STATUS.md` ‚≠ê **Start here**
- Security log ‚Üí `spec/AUDIT.md` (complete history)
- Past bugs ‚Üí `spec/HISTORICAL_FIXES.md`

### Protocol Reference

- Governance ‚Üí `spec/GOV.md`
- Fee distribution ‚Üí `spec/FEE_SPLITTER.md`
- User flows ‚Üí `spec/USER_FLOWS.md`
- Testing ‚Üí `spec/TESTING.md`
- Multisig ‚Üí `spec/MULTISIG.md`

### History & Planning

- Evolution ‚Üí `spec/CHANGELOG.md`
- Future ‚Üí `spec/FUTURE_ENHANCEMENTS.md`

### Archive Navigation

- Archive hub ‚Üí `spec/archive/README.md`
- Audits ‚Üí `spec/archive/audits/README.md`
- Consolidations ‚Üí `spec/archive/consolidations/README.md`
- Findings ‚Üí `spec/archive/findings/README.md`
- Testing ‚Üí `spec/archive/testing/README.md`
- Designs ‚Üí `spec/archive/obsolete-designs/README.md`

---

## Decision Tree: Where Does This Doc Go?

```
Is it current active work?
‚îú‚îÄ YES ‚Üí Which topic?
‚îÇ  ‚îú‚îÄ Governance ‚Üí GOV.md
‚îÇ  ‚îú‚îÄ Fees ‚Üí FEE_SPLITTER.md
‚îÇ  ‚îú‚îÄ Flows ‚Üí USER_FLOWS.md
‚îÇ  ‚îú‚îÄ Tests ‚Üí TESTING.md
‚îÇ  ‚îú‚îÄ Security findings ‚Üí AUDIT.md
‚îÇ  ‚îú‚îÄ Fixed bugs ‚Üí HISTORICAL_FIXES.md
‚îÇ  ‚îú‚îÄ Future features ‚Üí FUTURE_ENHANCEMENTS.md
‚îÇ  ‚îî‚îÄ Changes ‚Üí CHANGELOG.md
‚îî‚îÄ NO ‚Üí Archive it
   ‚îú‚îÄ Completed audit ‚Üí archive/audits/
   ‚îú‚îÄ Old consolidation ‚Üí archive/consolidations/
   ‚îú‚îÄ Specific finding ‚Üí archive/findings/
   ‚îú‚îÄ Test analysis ‚Üí archive/testing/
   ‚îî‚îÄ Old design ‚Üí archive/obsolete-designs/
```

---

## File Lifecycle

### NEW ANALYSIS

1. Create in `spec/` (e.g., `NEW_FINDING_ANALYSIS.md`)
2. Work on it (update frequently)
3. Within 1 week: Integrate into main doc OR archive

### MAIN DOCS (Rarely Archive)

- `AUDIT.md` - Never archive (master log)
- `HISTORICAL_FIXES.md` - Never archive (learning resource)
- `GOV.md`, `FEE_SPLITTER.md`, `USER_FLOWS.md` - Keep current
- `TESTING.md` - Keep current
- `CHANGELOG.md`, `FUTURE_ENHANCEMENTS.md` - Keep current
- `MULTISIG.md` - Keep current

---

## Consolidation Triggers

**Consolidate when:**

1. **spec/ has > 20 files** ‚Üí Target: 12-15 files
2. **Multiple overlapping docs** ‚Üí Merge into one
3. **Temp analysis > 1 week old** ‚Üí Integrate into main doc or archive
4. **"Which doc should I read?"** ‚Üí Too many options, need to merge

**Steps:**

```bash
# 1. List current files
ls spec/*.md | wc -l # If > 20, consolidate!

# 2. Identify duplicates/overlaps
# Look for: *_SUMMARY, *_VALIDATION, *_ACTIONS on same topic

# 3. Merge related docs
# Example: Multiple findings ‚Üí Single AUDIT.md entry

# 4. Move completed work
mv COMPLETED_AUDIT_*.md spec/archive/audits/

# 5. Update navigation
# Edit spec/README.md with new structure

# 6. Create consolidation record
# spec/archive/consolidations/CONSOLIDATION_[YYYY_MM_DD_PHASE_N].md
```

---

## Consolidation Summary Creation

### NAMING CONVENTION (Auto-sorts by recency)

```
CONSOLIDATION_[YYYY]_[MM]_[DD]_PHASE_[N].md

Examples (sorted newest first with ls -r):
- CONSOLIDATION_2025_11_03_PHASE_3.md  ‚Üê Newest
- CONSOLIDATION_2025_11_03_PHASE_2.md
- CONSOLIDATION_2025_11_03_PHASE_1.md
- CONSOLIDATION_2025_10_30_GENERAL.md  ‚Üê Oldest
```

### LOCATION

**Always:** `spec/archive/consolidations/` (never in spec/ root)

### 10-SECTION TEMPLATE

1. **Header with Metadata** - Date, Phase, Duration, Reason
2. **Executive Summary** - Goal, why consolidation needed, approach
3. **Before & After Metrics** - Active files, archive files, other metrics
4. **Files Moved** - Source ‚Üí Destination ‚Üí Reason (per category)
5. **Files Merged** - List of files ‚Üí Merged into ‚Üí Result
6. **Files Updated** - Which spec/ files changed and what changed
7. **Archive Reorganization** - New subdirectories, structure improvements
8. **Navigation Changes** - Old paths ‚Üí New paths, verification results
9. **Lessons & Notes** - What worked, challenges, recommendations
10. **Files Not Included (Reasoning)** - Why files stayed in root, exceptions

### BEST PRACTICES

‚úÖ **DO:**

- Include concrete metrics (before/after numbers)
- Document the "why" behind each move
- Verify all links work post-consolidation
- Include specific date with phase number
- Store ONLY in spec/archive/consolidations/

‚ùå **DON'T:**

- Keep consolidation records in spec/ root
- Create generic "CONSOLIDATION.md" (needs date)
- Skip before/after metrics
- Forget to document reasoning
- Consolidate without recording summary

---

## Archive Organization & Maintenance

### PURPOSE

Keep archive organized, searchable, and maintainable. Archive is NOT dumping ground‚Äîit's structured historical record.

**Archive is the SOURCE OF TRUTH FOR HISTORY**

### CANONICAL STRUCTURE

```
spec/archive/
‚îú‚îÄ‚îÄ README.md                    ‚≠ê Archive navigation hub
‚îú‚îÄ‚îÄ consolidations/              üìÖ Consolidation records
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ CONSOLIDATION_*.md (sorted by recency)
‚îú‚îÄ‚îÄ audits/                      üîê Completed audit work (40+ files)
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ EXTERNAL_AUDIT_0.md
‚îÇ   ‚îú‚îÄ‚îÄ EXTERNAL_AUDIT_2_COMPLETE.md
‚îÇ   ‚îú‚îÄ‚îÄ audit-2-details/
‚îÇ   ‚îú‚îÄ‚îÄ audit-3-details/
‚îÇ   ‚îú‚îÄ‚îÄ audit-4/
‚îÇ   ‚îî‚îÄ‚îÄ audit-4-details/
‚îú‚îÄ‚îÄ findings/                    üîç Analysis & findings (55+ files)
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ COMPARATIVE_AUDIT.md
‚îÇ   ‚îú‚îÄ‚îÄ ADERYN_ANALYSIS.md
‚îÇ   ‚îú‚îÄ‚îÄ implementation-analysis/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [20+ technical analysis files]
‚îÇ   ‚îî‚îÄ‚îÄ oct-2025/
‚îÇ       ‚îú‚îÄ‚îÄ README.md
‚îÇ       ‚îî‚îÄ‚îÄ [30 analysis files]
‚îú‚îÄ‚îÄ testing/                     üìä Historical test analysis (2 files)
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ COVERAGE_ANALYSIS.md
‚îî‚îÄ‚îÄ obsolete-designs/            üóÉÔ∏è Old design exploration (10 files)
    ‚îú‚îÄ‚îÄ README.md
    ‚îî‚îÄ‚îÄ [design exploration documents]
```

### EVERY SUBDIRECTORY MUST HAVE README.md

Each subdirectory README explains:

1. **Purpose:** What is stored here and why
2. **Contents:** List of files with descriptions
3. **When Added:** When files are added here
4. **Cross-References:** Links to related spec/ documents
5. **Maintenance:** When/how to clean up or reorganize

### ARCHIVE ORGANIZATION WORKFLOW

When consolidating documentation:

1. **Identify files to archive:**
   - Completed audits ‚Üí `archive/audits/`
   - Analysis/findings ‚Üí `archive/findings/` or `archive/oct-2025/` (if recent)
   - Consolidation records ‚Üí `archive/consolidations/`
   - Test reports ‚Üí `archive/testing/`
   - Old designs ‚Üí `archive/obsolete-designs/`

2. **Organize with subdirectories:**
   - Group detailed reports in `audit-N-details/`
   - Create `implementation-analysis/` for technical docs
   - Use `oct-YYYY/` for temporary analysis (temporary only!)

3. **Add README.md to each subdirectory:**
   - Purpose, contents list, when files are added
   - Cross-references, maintenance notes

4. **Update archive/README.md:**
   - Add new sections for subdirectories
   - Update statistics (total files, last update date)
   - Update navigation table
   - Verify all cross-references

5. **CRITICAL: Sync top-level spec/ documents:**
   - **spec/README.md** ‚Üí Update archive section with new structure
   - **spec/AUDIT_STATUS.md** ‚Üí Update archive references if changed
   - **spec/CHANGELOG.md** ‚Üí Add consolidation entry
   - **spec/archive/README.md** ‚Üí Already updated above
   - **Verify all links in spec/ point to correct archive locations**

### ARCHIVE MAINTENANCE RULES

‚úÖ **DO:**

- Keep archive organized by type/purpose
- Add README.md to every subdirectory
- Update statistics monthly
- Verify links quarterly
- Use consistent naming conventions
- Document why files are archived

‚ùå **DON'T:**

- Mix different file types in same directory
- Create nested subdirectories > 2 levels deep
- Skip README files in subdirectories
- Archive without updating spec/ documents
- Leave orphaned files (not in any subdirectory)
- Create temp directories that stay forever (move within 2 weeks)

### TEMPORARY ANALYSIS HANDLING

Recent analysis (< 2 weeks old) can use temporary monthly directories:

- Example: `archive/oct-2025/` for October 2025 analysis
- Purpose: Hold analysis during development phase
- Requirement: Move to permanent location or delete after 2 weeks
- Never: Create `archive/temp/` or `archive/misc/`

### SYNCING TOP-LEVEL SPEC AFTER ARCHIVE ORGANIZATION

After organizing archive, ALWAYS update:

1. **spec/README.md**
   - Update "Archive" section with new structure
   - Update file count references
   - Ensure archive links work

2. **spec/AUDIT_STATUS.md**
   - Update archive references if needed
   - Add links to archived audit reports

3. **spec/CHANGELOG.md**
   - Add entry: `[CONSOLIDATION] - YYYY-MM-DD - Archive Reorganized`
   - Document what changed

4. **spec/archive/README.md**
   - Updated during archive organization (step 4 above)
   - Verify all external links work

5. **Verification (CRITICAL!):**
   - Run: `grep -r "spec/archive" spec/*.md`
   - Check all archive references point to correct paths
   - Verify no broken links
   - Test navigating from spec/ to archive/

### ARCHIVE ORGANIZATION CHECKLIST

```
Before Moving Files to Archive:
  ‚òê Decide which archive subdirectory each file belongs
  ‚òê Create subdirectories if needed
  ‚òê Create README.md in each new subdirectory
  ‚òê Update README.md content with files list

Moving Files:
  ‚òê Move files to appropriate archive/ subdirectory
  ‚òê Verify files moved (not copied)
  ‚òê Update archive/ README file statistics
  ‚òê Add cross-references in new README.md files

After Moving to Archive:
  ‚òê Update spec/README.md archive section
  ‚òê Update spec/AUDIT_STATUS.md if applicable
  ‚òê Update spec/CHANGELOG.md with consolidation entry
  ‚òê Verify all links work: grep -r "archive/" spec/

Verification:
  ‚òê Run broken link check (grep and path verification)
  ‚òê Manually test 3-5 random archive links from spec/
  ‚òê Confirm archive structure matches documentation
  ‚òê Check file counts match what README says
```

---

## Anti-Patterns (Don't Do This)

‚ùå **Create summary of summary** - Update existing or archive  
‚ùå **Create temp file and forget** - Integrate within 1 week  
‚ùå **Duplicate information** - Merge into single doc  
‚ùå **Reference deleted files** - Update links when consolidating  
‚ùå **Keep completed work in root** - Move to archive/  
‚ùå **No README in archive/** - Always add navigation  
‚ùå **Archive without syncing spec/** - Update spec/ files first

---

## Maintenance Schedule

### Weekly (During Active Development)

- Update `AUDIT_STATUS.md` with progress
- Update `AUDIT.md` with new findings
- Check for temp files > 1 week old

### After Each Fix

- Update `AUDIT.md` with finding + fix
- Update `HISTORICAL_FIXES.md` if bug fix
- Update `CHANGELOG.md` if feature change

### After Audit Completion

- Move completed audit docs to `archive/audits/`
- Update `AUDIT_STATUS.md`
- Update `README.md` if structure changed

### Quarterly

- Review `FUTURE_ENHANCEMENTS.md`
- Archive obsolete analysis files
- Verify all links work
- Update archive statistics

---

## Current vs Historical

### Use CURRENT (spec/ root) for

- ‚úÖ Active protocol work
- ‚úÖ Protocol reference (governance, fees, flows)
- ‚úÖ Security master log (all findings)
- ‚úÖ Testing guides
- ‚úÖ Planning docs (changelog, roadmap)

### Use HISTORICAL (spec/archive/) for

- ‚úÖ Completed audits (all findings fixed)
- ‚úÖ Past consolidation records
- ‚úÖ Specific findings (now in AUDIT.md)
- ‚úÖ Old test analysis (superseded)
- ‚úÖ Obsolete design explorations

### NEVER

- ‚ùå Reference archive/ for current implementation
- ‚ùå Put active work in archive/
- ‚ùå Create docs outside spec/ (except temp, then move within 1 day)

---

## Quick Reference Card

```
NEED TO KNOW CURRENT AUDIT STATUS?
‚Üí spec/AUDIT_STATUS.md ‚≠ê

NEED GOVERNANCE INFO?
‚Üí spec/GOV.md üìñ

NEED TO UNDERSTAND A FLOW?
‚Üí spec/USER_FLOWS.md üìñ

NEED TO WRITE TESTS?
‚Üí spec/TESTING.md üìñ

NEED SECURITY HISTORY?
‚Üí spec/AUDIT.md üîê

NEED TO KNOW WHAT WAS FIXED?
‚Üí spec/HISTORICAL_FIXES.md üîê

NEED HISTORICAL CONTEXT?
‚Üí spec/archive/ üì¶

NEED TO NAVIGATE ARCHIVE?
‚Üí spec/archive/README.md ‚≠ê

LOST? START HERE:
‚Üí spec/README.md ‚≠ê
```

---

**Last Updated:** November 3, 2025  
**Current Spec Status:** 13 active files, 116+ archived  
**Archive Structure:** 5 organized subdirectories with README navigation  
**Consolidation Summary Location:** `spec/archive/consolidations/CONSOLIDATION_YYYY_MM_DD_PHASE_N.md`  
**Next Review:** After next consolidation or when spec/ reaches 20+ active files  
**Maintainer:** Follow these rules to keep spec/ clean and organized!
